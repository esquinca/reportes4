<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use Openpay;

class OpentestController extends Controller
{
    public function test()
    {
		Openpay::setId('mrbligxkubjgct2a2vrd');
		Openpay::setApiKey('sk_7d8cfb248e4e4395a7ee80629decc6f2');

		Openpay::setProductionMode(true);

		$openpay = Openpay::getInstance('mrbligxkubjgct2a2vrd', 'sk_7d8cfb248e4e4395a7ee80629decc6f2');
		
		$datenow = date('Y-m-d');

		$findData = array(
			'creation[gte]' => $datenow,
			'creation[lte]' => $datenow,
			'limit' => 200,
			//'status' => 'FAILED'
		);

		$chargeList = $openpay->charges->getList($findData);
		//$charge = $openpay->charges->get('trzjz0azwjftwugfpzdh');

		// return $chargeList;
		$algo = $chargeList[0]->card->brand;
    	dd($chargeList);
    }

    public function curlZen()
    {
      //define("ZDURL", "https://sitwifi.zendesk.com/api/v2/tickets.json");

      $icomera = "https://www.moovmanage.com/public_api/devices?api_key=0a42192efb4d18aea7a9fad2ddd82e4a";
      $openpay = "https://sandbox-api.openpay.mx/v1/mrbligxkubjgct2a2vrd/customers";
      $openpayfull = "https://api.openpay.mx/v1/mrbligxkubjgct2a2vrd/charges/tryrvu45shnukvj7g48w";

      $ch = curl_init();
      //echo "Inicializa la funcion .. ";
      curl_setopt($ch, CURLOPT_TIMEOUT, 50);
      curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
      curl_setopt($ch, CURLOPT_FOLLOWLOCATION, false );
      curl_setopt($ch, CURLOPT_MAXREDIRS, 10 );
      curl_setopt($ch, CURLOPT_URL, $openpayfull);
      curl_setopt($ch, CURLOPT_USERPWD, "sk_7d8cfb248e4e4395a7ee80629decc6f2");
      curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "GET");
      curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-type: application/json'));
      curl_setopt($ch, CURLOPT_USERAGENT, "MozillaXYZ/1.0");

      //curl_setopt($ch, CURLOPT_POSTFIELDS, $json);

      curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
      curl_setopt($ch, CURLOPT_TIMEOUT, 10);

      //echo ".. Termina la funcion ..";
      $output = curl_exec($ch);

      $curlerr = curl_error($ch);
      $curlerrno = curl_errno($ch);
      if ($curlerrno != 0) {
          return "Error en el curl";
      }else{

      }
      //echo '   Curl error number:  ' . curl_errno($ch) . '|| Curl error message: ' . curl_error($ch);
      curl_close($ch);
      $decoded = json_decode($output);

      dd($output);
      //return $output;

    }

}
